---
import type { GetStaticPaths } from "astro"
import { getCollection, type CollectionEntry } from "astro:content"
import Root from "@/layouts/Root.astro"
import Post from "@/layouts/Post.astro"
import Prose from "@/components/Prose.astro"
import Pagination from "@/components/Pagination.astro"
import ExternalLink from "@/components/ExternalLink.astro"
import { BottomMenu } from "@/components/bottom-menu"
import LucideIcon from "@/components/LucideIcon.astro"
import { Pen } from "lucide"

export const getStaticPaths = (async () => {
  const chapters = await getCollection("chapters")
  return chapters.map((c) => {
    return {
      params: { chapter: c.slug },
      props: c,
    }
  })
}) satisfies GetStaticPaths

type Props = CollectionEntry<"chapters">

const { render, data, id } = Astro.props
const { Content, remarkPluginFrontmatter, headings } = await render()
---

<Root
  title={data.title}
  description={data.description}
  creator={`@${data.authorSocial}`}
  image={data.image?.src}
>
  <Post slot="body" title={data.title}>
    <header class="mb-8 md:mb-10">
      <div class="rounded-lg bg-muted/40 px-6 py-4 space-y-2">
        <div class="flex justify-between">
          <p data-ghost-border-trigger class="text-muted-foreground">
            {remarkPluginFrontmatter.minutesRead}
          </p>
          <a
            class="underline underline-offset-4 flex items-center gap-x-1.5 text-sm"
            href={`https://github.com/michelangelo-valderrama/understanding-astro-webook/blob/main/src/content/chapters/${id}`}
            target="_blank"
            rel="noopener noreferrer"
          >
            <span>Edit page</span>
            <LucideIcon class="size-3.5" icon={Pen} />
          </a>
        </div>
        {
          data.proyect && (
            <menu class="flex gap-x-6 underline ">
              {data.proyect?.view && (
                <li>
                  <ExternalLink href={data.proyect.view}>
                    View demo
                  </ExternalLink>
                </li>
              )}
              {data.proyect?.source && (
                <li>
                  <ExternalLink href={data.proyect.source}>
                    Source code
                  </ExternalLink>
                </li>
              )}
            </menu>
          )
        }
      </div>
    </header>

    <main>
      <Prose>
        <h1>{data.title}</h1>
        <Content />
      </Prose>
    </main>

    <footer class="mb-20">
      <Pagination next={data.next} prev={data.prev} />
    </footer>
  </Post>

  <BottomMenu
    headings={[{ text: "Top", slug: "", depth: 2 }, ...headings]}
    client:only
  />
</Root>
